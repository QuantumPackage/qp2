name: QP CI

on:
  push:
    branches:
    - master
    - dev-stable
  pull_request:
    branches:
    - dev-stable
    - master
  workflow_dispatch:


jobs:

  configuration:
    runs-on: ubuntu-20.04
    name: Dependencies

    steps:
       - uses: actions/checkout@v2
       - name: install dependencies
         run: |
           sudo apt install gfortran gcc liblapack-dev libblas-dev wget python3 make m4 pkg-config

  compilation:
    name: Compilation
    runs-on: ubuntu-20.04

    steps:
       - uses: actions/checkout@v2
       - name: Restore configuration
         id: restore
         uses: actions/cache@v3
         with:
           key: qp2-config
           path: |
             external
             include
             lib
             lib64
             libexec
       - if: ${{ steps.restore.outputs.cache-hit != 'true' }}
         continue-on-error: false
       - name: configuration
         run: |
              ./configure -c ./config/gfortran_debug.cfg
       - name: compile
         run: |
              bash -c "source quantum_package.rc ; exec ninja"



